# Rock-specific shell functions
# 
# The bundle support requires the base/scripts package to be installed
function rock-bundle-sel() {
    if ! test -f $AUTOPROJ_PROJECT_BASE/.bundle_env.sh; then
        echo "something's wrong: the $AUTOPROJ_PROJECT_BASE/.env_bundle.sh does not exist."
        echo "have you successfully installed autoproj the base/scripts package ?"
        return 1
    fi

    name=$1
    bundle_path=$(rock-bundle-find $name)
    if test "x$?" != "x0"; then
        echo "cannot find bundle $name, run bundle-info to get the list of available bundles"
        return 1
    elif test -z "$name" || test -d "$name"; then
        export ROCK_BUNDLE=$bundle_path
        rock-bundle-info
        return 0
    else
        export ROCK_BUNDLE=$name
        rock-bundle-info
        return 0
    fi
}
function rock-bundle-default() {
    if ! test -f $AUTOPROJ_PROJECT_BASE/.bundle_env.sh; then
        echo "something's wrong: the $AUTOPROJ_PROJECT_BASE/.env_bundle.sh does not exist."
        echo "have you successfully installed autoproj the base/scripts package ?"
        return 1
    fi

    if rock-bundle-sel $1; then
        echo "# File generated by the bundle-default command" > $AUTOPROJ_PROJECT_BASE/.bundle_env.sh
        echo "# Do not change ! Your changes would be overriden !" >> $AUTOPROJ_PROJECT_BASE/.bundle_env.sh
        echo "export ROCK_BUNDLE=$ROCK_BUNDLE" >> $AUTOPROJ_PROJECT_BASE/.bundle_env.sh
        return 0
    fi
}
function rock-bundle-unsel() {
    unset ROCK_BUNDLE
}

alias bundle-sel=rock-bundle-sel
alias bundle-unsel=rock-bundle-unsel
alias bundle-default=rock-bundle-default
alias bundle-find=rock-bundle-find
alias bundle-info=rock-bundle-info
