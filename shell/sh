# Rock-specific shell functions
# 
# The bundle support requires the base/scripts package to be installed
__rock_bundle_sel() {
    if ! test -f $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh; then
        echo "something's wrong: the $AUTOPROJ_CURRENT_ROOT/.env_bundle.sh does not exist."
        echo "have you successfully installed autoproj the base/scripts package ?"
        return 1
    fi

    name=$1
    bundle_path=$(rock-bundle-find $name)
    if test "x$?" != "x0"; then
        echo "cannot find bundle $name, run bundle-info to get the list of available bundles"
        return 1
    elif test -z "$name" || test -d "$name"; then
        export ROCK_BUNDLE=$bundle_path
        rock-bundle-info
        return 0
    else
        export ROCK_BUNDLE=$name
        rock-bundle-info
        return 0
    fi
}
__rock_bundle_default() {
    if ! test -f $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh; then
        echo "something's wrong: the $AUTOPROJ_CURRENT_ROOT/.env_bundle.sh does not exist."
        echo "have you successfully installed autoproj the base/scripts package ?"
        return 1
    fi

    if test -z "$1"; then
        echo "# File generated by the bundle-default command" > $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh
        echo "# Do not change ! Your changes would be overriden !" >> $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh
        echo "unset ROCK_BUNDLE" >> $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh
    elif rock-bundle-sel $1; then
        echo "# File generated by the bundle-default command" > $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh
        echo "# Do not change ! Your changes would be overriden !" >> $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh
        echo "export ROCK_BUNDLE=$ROCK_BUNDLE" >> $AUTOPROJ_CURRENT_ROOT/.bundle_env.sh
        return 0
    fi
}
__rock_bundle_unsel() {
    unset ROCK_BUNDLE
}

alias rock-bundle-sel=__rock_bundle_sel
alias rock-bundle-unsel=__rock_bundle_unsel
alias rock-bundle-default=__rock_bundle_default
alias bundle-sel=__rock_bundle_sel
alias bundle-unsel=__rock_bundle_unsel
alias bundle-default=__rock_bundle_default
alias bundle-find=rock-bundle-find
alias bundle-info=rock-bundle-info
