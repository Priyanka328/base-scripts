require 'Qt'

require 'rock/doc'
require 'qtwebkit'

require 'orocos'
Orocos.load

app = Qt::Application.new(ARGV)

main = Qt::Widget.new
main_layout = Qt::HBoxLayout.new(main)
splitter = Qt::Splitter.new
main_layout.add_widget(splitter)

view = Qt::ListWidget.new(splitter)
text = Qt::WebView.new(splitter)
splitter.add_widget(view)
splitter.add_widget(text)

view.connect(SIGNAL('itemClicked(QListWidgetItem*)')) do |item|
    model = Orocos.task_model_from_name(item.text)
    html =<<-EOF
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <link rel="stylesheet" href="file://#{File.join(Rock::Doc::HTML.template_path, "style.css")}" type="text/css" />
</head>
<body>
    #{Rock::Doc::HTML.render_object(model, 'orogen_task_fragment.page')}
</body>
    EOF
    text.setHtml(html)
end

Orocos.available_task_models.keys.sort.each do |name|
    view.add_item(name)

end

main.show

app.exec
